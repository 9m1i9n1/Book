## 2장. 타락한 객체

### 일반적인 TDD 주기

1. 테스트를 작성한다. 마음속에 있는 오퍼레이션이 코드에 어떤식으로 나타나길 원하는지 생각해 보라. 이야기를 써내려가는 것이다. 원하는 인터페이스를 개발하라. 올바른 답을 얻기 위해 필요한 이야기의 모든 요소를 포함시켜라.
2. 실행 가능하게 만든다. 다른 무엇보다도 중요한 것은 빨리 초록막대를 보는 것이다. 깔끔하고 단순한 해법이 명백히 보인다면 그것을 입력하라. 만약 구현하는 데 몇 분 정도 걸릴 것 같으면 일단 적어 놓은 뒤에 원래 문제(초록 막대를 보는것)로 돌아오자. 미적인 문제에 대한 이러한 전환은 몇몇 숙련된 소프트웨어 공학자들에게는 어려운 일이다.
3. 올바르게 만든다. 이제 시스템이 작동하므로 직전에 저질렀던 죄악을 수습하자. 좁고 올곧은 소프트웨어 정의의 길로 되돌아와서 중복을 제거하고 초록 막대로 되돌리자.

**우리의 목적은 작동하는 깔끔한 코드를 얻는 것이다!**

전체 문제 중에서 `작동하는`에 해당하는 부분을 먼저 해결하고 `깔끔한 코드` 부분을 해결한다.  
이러한 방식은 `깔끔한 코드`를 해결한 후에 `작동하는` 부분을 해결해 가면서 배운 것들을 설계에 반영하느라 허둥거리는 아키텍처 주도개발과 정반대다.

---

### 달러 부작용

```
$5 + 10 CHF = $10(환율이 2:1일 경우)
$5 * 2 = $10 ▶완료
amount를 private로 만들기
Dollar 부작용(side effect)? ▶진행중
Money 반올림?
```

```java
public void testMultiplication() {
    Dollar five = new Dollar(5);
    five.times(2);
    assertEquals(10, five.amount);
    five.times(3);
    assertEquals(15, five.amount);
}
```

다음과 같이 테스트를 진행하기 위해서는 새로운 객체를 반환하여야 기존의 5달러를 가지고 온종일 곱하기를 수행해도 괜찮을 것이다.  
**이렇게 하려면 Dollar의 인터페이스를 수정해야 하고, 테스트도 수정해야하는데, 문제될 건 없다.**  
어떤 구현이 올바른가에 대한 우리 추측이 완벽하지 못한 것과 마찬가지로 올바른 인터페이스에 대한 추측 역시 절대 완벽하지 못하다.

---

### 코드 수정

```java
public class Dollar {
    int amount;

    public Dollar(int amount) {
        this.amount = amount;
    }

    Dollar times(int multiplier) {

        return new Dollar(amount * multiplier);
    }
}
```

```java
@Test
public void testMultiplication() {
    Dollar five = new Dollar(5);
    Dollar product = five.times(2);
    assertEquals(10, product.amount);
    product = five.times(3);
    assertEquals(15, product.amount);
}
```

---

### TDD의 전략

1. **가짜로 구현하기**
   상수를 반환하게 만들고 진짜 코드를 얻을 때까지 단계적으로 상수를 변수로 바꾸어 간다.
2. **명백한 구현 사용하기**
   실제 구현을 입력한다.

---

### **[현재까지의 진행 상황]**

```
$5 + 10 CHF = $10(환율이 2:1일 경우)
$5 * 2 = $10 ▶완료
amount를 private로 만들기
Dollar 부작용(side effect)? ▶완료
Money 반올림?
```

- 설계상의 결함(Dollar 부작용)을 그 결함으로 인해 실패하는 테스트로 변환했다.
- 스텁 구현으로 빠르게 컴파일을 통과하도록 만들었다.
- 올바르다고 생각하는 코드를 입력하여 테스트를 통과했다.

<U>느낌(부작용에 대한 혐오감)을 테스트(하나의 Dollar 객체에 곱하기를 두 번 수행하는 것)로 변환하는 것은 TDD의 일반적 주제다.  
이런 작업을 오래 할수록 미적 판단을 테스트로 담아내는 것에 점점 익숙해지게 된다.</U>
